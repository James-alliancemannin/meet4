<!-- JavaScript: Supabase sign-up + splash control -->
<script>
  // === Supabase Config ===
  const SUPABASE_URL = 'https://your-project-ref.supabase.co';      // ← REPLACE
  const SUPABASE_ANON_KEY = 'your-anon-public-key';                // ← REPLACE

  // Use 'sb' to avoid name conflict with global supabase from CDN
  const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  // Sign-up function
  async function signUp() {
    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value.trim();
    const errorEl = document.getElementById('error-message');
    const successEl = document.getElementById('success-message');
    const form = document.getElementById('signup-form');

    errorEl.style.display = 'none';
    successEl.style.display = 'none';

    if (!email || !password) {
      errorEl.textContent = 'Please enter email and password';
      errorEl.style.display = 'block';
      return;
    }

    const { data, error } = await sb.auth.signUp({
      email,
      password,
      options: {
        emailRedirectTo: window.location.origin + '/landing/'
      }
    });

    if (error) {
      errorEl.textContent = error.message || 'Sign up failed — try again';
      errorEl.style.display = 'block';
      console.error('Sign-up error:', error);
    } else {
      form.style.display = 'none';
      successEl.style.display = 'block';
      console.log('Sign-up success - check email');
    }
  }

  // Splash control (unchanged from previous fix)
  const splash = document.getElementById('splash');
  const mainContent = document.getElementById('main-content');
  const video = document.getElementById('introVideo');

  function closeSplash(source = 'unknown') {
    console.log(`closeSplash called from: ${source}`);
    if (splash) splash.classList.add('hidden');
    if (mainContent) mainContent.classList.remove('hidden');
    if (video) video.pause();
  }

  if (video) {
    video.onended = () => closeSplash('onended');

    video.addEventListener('timeupdate', () => {
      if (video.duration && video.currentTime >= video.duration - 0.5) {
        closeSplash('timeupdate near end');
      }
    });

    video.addEventListener('loadedmetadata', () => {
      const duration = video.duration || 8;
      setTimeout(() => {
        if (!splash.classList.contains('hidden')) {
          closeSplash('duration fallback');
        }
      }, (duration * 1000) + 3000);
    });
  }

  if (splash) {
    splash.addEventListener('click', () => closeSplash('click'));
    splash.addEventListener('touchend', () => closeSplash('touch'));
  }

  document.addEventListener('keydown', (e) => {
    if (!splash.classList.contains('hidden')) {
      closeSplash('keydown');
    }
  });

  setTimeout(() => {
    if (!splash.classList.contains('hidden')) {
      closeSplash('ultimate fallback 20s');
    }
  }, 20000);

  console.log('Splash and sign-up script loaded');
</script>
